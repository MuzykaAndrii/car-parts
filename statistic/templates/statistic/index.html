{% extends "layout/base.html" %}
{% load static %}

{% block title %}Статистика | FDA.if{% endblock title %}

{% block head-scripts %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
{% endblock head-scripts %}


{% block content %}

<h3 class="text-center mb-5">Прибуток: {{ total_margin }}</h3>
<div class="row">
    <div class="custom col-2">
        <h6>Статистика за:</h6>
        <div class="ranges btn-group-vertical w-100">
            <a role="button" class="btn w-100 btn-outline-primary" href="{% url 'stats:index' %}">Увесь час</a>
            <a role="button" class="btn w-100 btn-outline-primary" href="{% url 'stats:index' %}?from={{ yearly.from }}&to={{ yearly.to }}">Останній рік</a>
            <a role="button" class="btn w-100 btn-outline-primary" href="{% url 'stats:index' %}?from={{ monthly.from }}&to={{ monthly.to }}">Останній місяць</a>
            <a role="button" class="btn w-100 btn-outline-primary" href="{% url 'stats:index' %}?from={{ weekly.from }}&to={{ weekly.to }}">Останній тиждень</a>
        </div>

        <h6 class="mt-5">Певний проміжок:</h6>
        <form class="form-inline" method="get" action="{% url 'stats:index' %}">
            <div class="input-group mb-2">
                <span class="input-group-text" id="basic-addon1">Із: </span>
                <input class="form-control" type="date" name="from" id="from" value="{{ request.GET.from }}">
            </div>
        
            <div class="input-group mb-2">
                <span class="input-group-text" id="basic-addon1">До: </span>
                <input class="form-control" type="date" name="to" id="to" value="{{ request.GET.to }}">
            </div>
        
            <button type="submit" class="btn btn-primary w-100">Показати</button>
        </form>
    </div>


    <div class="col-10">
        <canvas id="myChart"></canvas>
    </div>
</div>

<div class="hidden">
    {% for date in sale_date %}
    <p class="chart_date_value">{{date|date:"j.n.Y"}}</p>
    {%endfor%}
    {% for value in sale_values %}
    <p class="chart_sale_value">{{value}}</p>
    {%endfor%}

    {% for value in margins %}
    <p class="chart_margin_values">{{ value }}</p>
    {% endfor %}
</div>
{% endblock content %}

{% block scripts %}
<script>
    const ctx = document.getElementById('myChart');
    let dates = []
    let sales = []
    let margins = []

    document.querySelectorAll('.chart_date_value').forEach((el) => {
        dates.push(el.innerHTML)
    })
    document.querySelectorAll('.chart_sale_value').forEach((el) => {
        sales.push(parseFloat(el.innerHTML))
    })

    document.querySelectorAll('.chart_margin_values').forEach((el) => {
        margins.push(parseFloat(el.innerHTML))
    })

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: dates,
            datasets: [
                {
                    label: 'Продажі',
                    data: sales,
                    borderWidth: 4,
                    fill: true,
                    borderColor: 'rgb(75, 192, 192)',
                    tension: 0.3,
                },
                {
                    label: "Заробіток",
                    data: margins,
                    borderWidth: 2,
                    fill: true,
                    borderColor: 'rgb(252, 186, 3)',
                    tension: 0.3,
                },
            ]
        },
    });
</script>
{% endblock scripts %}